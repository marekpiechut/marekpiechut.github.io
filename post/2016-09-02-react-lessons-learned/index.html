<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>One year with React | rand(4) Thoughts</title>
<meta name=keywords content="react,javascript"><meta name=description content="It&rsquo;s almost a year now since I&rsquo;m working with React and Flux. After all this time I think I&rsquo;ve learned a lot about how to build React apps, so they are easy to test, maintain and that components can be easily reused.
Here are some of my most important conclusions. I think following them will make your life really easier, especially if you&rsquo;re just starting with it.
Is it worth it?"><meta name=author content><link rel=canonical href=https://marekpiechut.github.io/post/2016-09-02-react-lessons-learned/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://marekpiechut.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://marekpiechut.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://marekpiechut.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://marekpiechut.github.io/apple-touch-icon.png><link rel=mask-icon href=https://marekpiechut.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://marekpiechut.github.io/post/2016-09-02-react-lessons-learned/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script defer data-domain=marekpiechut.github.io src=https://insights.dayone.pl/js/script.js></script><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Inter:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel=stylesheet><style>body{font-family:inter,sans-serif;font-optical-sizing:auto;font-size:16px;font-style:normal;letter-spacing:-.3px;--theme:#f4f4f4}h1,h2,h3,h4,h5,h6,.entry-link,.logo{font-family:montserrat,sans-serif;font-optical-sizing:auto;font-style:normal}</style><meta property="og:title" content="One year with React"><meta property="og:description" content="It&rsquo;s almost a year now since I&rsquo;m working with React and Flux. After all this time I think I&rsquo;ve learned a lot about how to build React apps, so they are easy to test, maintain and that components can be easily reused.
Here are some of my most important conclusions. I think following them will make your life really easier, especially if you&rsquo;re just starting with it.
Is it worth it?"><meta property="og:type" content="article"><meta property="og:url" content="https://marekpiechut.github.io/post/2016-09-02-react-lessons-learned/"><meta property="og:image" content="https://marekpiechut.github.io/images/cover.jpg"><meta property="article:section" content="post"><meta property="article:published_time" content="2016-09-02T23:59:59+00:00"><meta property="article:modified_time" content="2016-09-02T23:59:59+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://marekpiechut.github.io/images/cover.jpg"><meta name=twitter:title content="One year with React"><meta name=twitter:description content="It&rsquo;s almost a year now since I&rsquo;m working with React and Flux. After all this time I think I&rsquo;ve learned a lot about how to build React apps, so they are easy to test, maintain and that components can be easily reused.
Here are some of my most important conclusions. I think following them will make your life really easier, especially if you&rsquo;re just starting with it.
Is it worth it?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://marekpiechut.github.io/post/"},{"@type":"ListItem","position":2,"name":"One year with React","item":"https://marekpiechut.github.io/post/2016-09-02-react-lessons-learned/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"One year with React","name":"One year with React","description":"It\u0026rsquo;s almost a year now since I\u0026rsquo;m working with React and Flux. After all this time I think I\u0026rsquo;ve learned a lot about how to build React apps, so they are easy to test, maintain and that components can be easily reused.\nHere are some of my most important conclusions. I think following them will make your life really easier, especially if you\u0026rsquo;re just starting with it.\nIs it worth it?","keywords":["react","javascript"],"articleBody":"It’s almost a year now since I’m working with React and Flux. After all this time I think I’ve learned a lot about how to build React apps, so they are easy to test, maintain and that components can be easily reused.\nHere are some of my most important conclusions. I think following them will make your life really easier, especially if you’re just starting with it.\nIs it worth it? Everybody at my team is still happy with react. Our app is quite big now and, despite having some issues integrating with external libraries, it’s still great experience. Of course we had to refactor our code and change working patterns quite a few times during the project. Mostly because React was pretty new when we started and proven ‘best practices’ were yet to be seen. Yet it’s still a nice experience to work with it.\nCompared to other technologies we have used, React is really fast to start with and has very few concepts to grasp to be productive. It also works very well with immutable data and makes it easy to reuse components.\nIf you’re still unsure if React is for you, I highly recommend you give it a try. It’s really good and you can be pretty productive even after your project has grown big.\nProject structure From the beginning we started to organize our code after domain concepts and functionalities. This is simply the best way to keep stuff around. Forget all this nonsense about actions, components, stores folders. After your project grows it’ll make you suffer. Keeping all business related stuff together makes moving things around really easy. You can easily find things you plan to change, remove functionalities and refactor.\nSo how does our directory structure looks like? Here’s an example:\nROOT |- src |-- core (application core abstractions and main component) |-- components (basic reusable components that are not domain specific, ex: confirm popup, section, date selector, etc. |-- modules (here goes all the important stuff) |--- advanced-search |---- advanced-search-component.jsx |---- advanced-search-component.test.jsx |---- advanced-search-store.js |---- advanced-search-store.test.js |---- advanced-search-toolbar-component.jsx |---- advanced-search-actions.js |---- index.js (what we export in this module) |--- user-profile |---- ... |- test |-- pages (Page objects for e2e tests) |-- e2e (Selenium end to end/UI tests) As you can see, we keep unit tests in same directories as production code. This way we can have relative import paths and we don’t have to change anything when we move whole modules around. Want to move some components to another module? No problem, just move all files.\nIt’s also not a problem when we release. Tests are filtered out from production bundle with simple regular expression.\nIt’s also a good idea to keep index.js file inside each module and make sure external code use only module path to import stuff. It allows you to make import names shorter and more meaningful. It’s also a form of ‘poor mans’ encapsulation:\nconst AdvancedSearch = require('modules/advanced-search').component Components and state This is something that took us a while to figure out. I think that you should always keep display components stateless. You can usually use React stateless functional components for this.\nOf course you’ll need also somehow to map store state to your UI. This should be done inside separate, stateful components. These should not mess with presentation. They should pass all their state to child components by props, eventually select which components to render based on state, nothing more. How things look is totally up to stateless components.\nIt’ll make your components really easy to test and they’ll be as reusable as possible. Without it you’ll be constantly fighting with stores mocking, just to test if divs rendered properly and that data is displayed where it should. Managing state along with presentation also makes your components hard to reuse. Not to mention that components messing with state and presentation at once can get large.\nMost of the time you should be able to generate these stateful wrappers or they will be very simple to write and test.\nTo be honest, we still have quite a few these stateful display components in our project waiting to be refactored, but it’s not something I recommend to have. It’s painful to make any changes in them.\nTesting We don’t use Jest for testing. In my opinion mocking everything implicitly is not a very good idea. After a while you don’t know what’s mocked and what’s not.\nUpdate: As of version 15.0 Jest no longer mocks things by default. Haven’t used it very much, but I think it might be worth to try it out now.\nAll our components receive dependencies via props, so standard Jasmine/Karma testing suite is totally enough. We mock things and create spies as needed using plain JS and Jasmine. Every time we needed something more meant it was rather a design issue than library limitation (components trying to do too much or too big/nested data structures).\nEven stores are passed to stateful components using props. This way we can easily mock them or use real objects when needed and discard them afterwards. No ugly shared state that might not be cleaned up and break tests.\nAlso our stores and backend APIs use factories that get all outside dependencies from parameters:\nmodule.exports = { create: createSearchStore, default: createSearchStore(defaultDispatcher, backendApi.default), events } Again, mocking and cleaning up is very easy.\nImmutability You should keep all your data immutable. You can use things like Immutable.js and it will probably work pretty well (despite it’s sometime awkward APIs), but just not modifying anything in place and using Object.assign or similar utils instead will make your life much easier. Especially when you need to implement shouldComponentUpdate from time to time.\nThe lowest level you mutate anything should be store itself. Everything below should never be touched.\nDon’t be worried about performance. JS VMs are pretty damn fast when creating and destroying a lot of objects.\nState changes and async calls We keep all sate changing code inside stores. Stores mutate themselves in response to actions and action creators have no idea about internals of store. This also means that async calls are done inside store and do not call any actions. They just update internal state and fire regular store events.\nIt works pretty well for us despite being little controversial. Some guys recommend to do these things in actions and make your stores a dumb bag for data. This might also work well, especially when you need to intercept async calls globally and modify some other part of application state. But please decide which one you like more and stick to it. Having some of it in actions and some in stores will probably give you headache.\nAll business logic in stores makes our action creators dumb, so we usually generate them from simple object with events. If you go with second solution you can probably generate most of your stores.\nAlso it means we sometimes need to make stores listen to stores. We have few of these with no issues. It looks and works much better than ‘hacky’ waitFor in dispatcher API.\nRedux? After some time it appeared to me, that some of my conclusions are quite similar to what Dan Abramov is doing in Redux. It’s little bit more extreme with its single store and pure functions, but after testing it for some time I think it’s really good. So another good idea for your next app might be to simply use Redux. It’s something I’m probably going to do in mine.\n","wordCount":"1255","inLanguage":"en","image":"https://marekpiechut.github.io/images/cover.jpg","datePublished":"2016-09-02T23:59:59Z","dateModified":"2016-09-02T23:59:59Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://marekpiechut.github.io/post/2016-09-02-react-lessons-learned/"},"publisher":{"@type":"Organization","name":"rand(4) Thoughts","logo":{"@type":"ImageObject","url":"https://marekpiechut.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://marekpiechut.github.io/ accesskey=h title="rand(4) Thoughts (Alt + H)">rand(4) Thoughts</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://marekpiechut.github.io/ title=Home><span>Home</span></a></li><li><a href=https://marekpiechut.github.io/index.xml title=RSS><span>RSS</span></a></li><li><a href=https://marekpiechut.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://marekpiechut.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">One year with React</h1><div class=post-meta><span title='2016-09-02 23:59:59 +0000 UTC'>September 2, 2016</span></div></header><figure class=entry-cover><img loading=eager srcset="https://marekpiechut.github.io/post/2016-09-02-react-lessons-learned/images/cover_hu5459c0360c2b0cb7a147d2df0eb350ca_5065598_360x0_resize_q75_box.jpg 360w ,https://marekpiechut.github.io/post/2016-09-02-react-lessons-learned/images/cover_hu5459c0360c2b0cb7a147d2df0eb350ca_5065598_480x0_resize_q75_box.jpg 480w ,https://marekpiechut.github.io/post/2016-09-02-react-lessons-learned/images/cover_hu5459c0360c2b0cb7a147d2df0eb350ca_5065598_720x0_resize_q75_box.jpg 720w ,https://marekpiechut.github.io/post/2016-09-02-react-lessons-learned/images/cover_hu5459c0360c2b0cb7a147d2df0eb350ca_5065598_1080x0_resize_q75_box.jpg 1080w ,https://marekpiechut.github.io/post/2016-09-02-react-lessons-learned/images/cover_hu5459c0360c2b0cb7a147d2df0eb350ca_5065598_1500x0_resize_q75_box.jpg 1500w ,https://marekpiechut.github.io/post/2016-09-02-react-lessons-learned/images/cover.jpg 7806w" sizes="(min-width: 768px) 720px, 100vw" src=https://marekpiechut.github.io/post/2016-09-02-react-lessons-learned/images/cover.jpg alt width=7806 height=5304></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#is-it-worth-it aria-label="Is it worth it?">Is it worth it?</a></li><li><a href=#project-structure aria-label="Project structure">Project structure</a></li><li><a href=#components-and-state aria-label="Components and state">Components and state</a></li><li><a href=#testing aria-label=Testing>Testing</a></li><li><a href=#immutability aria-label=Immutability>Immutability</a></li><li><a href=#state-changes-and-async-calls aria-label="State changes and async calls">State changes and async calls</a></li><li><a href=#redux aria-label=Redux?>Redux?</a></li></ul></div></details></div><div class=post-content><p>It&rsquo;s almost a year now since I&rsquo;m working with <a href=https://facebook.github.io/react>React</a> and <a href=https://facebook.github.io/flux/>Flux</a>. After all this time I think I&rsquo;ve learned a lot about how to build React apps, so they are easy to test, maintain and that components can be easily reused.</p><p>Here are some of my most important conclusions. I think following them will make your life really easier, especially if you&rsquo;re just starting with it.</p><h1 id=is-it-worth-it>Is it worth it?<a hidden class=anchor aria-hidden=true href=#is-it-worth-it>#</a></h1><p>Everybody at my team is still happy with react. Our app is quite big now and, despite having some issues integrating with external libraries, it&rsquo;s still great experience. Of course we had to refactor our code and change working patterns quite a few times during the project. Mostly because React was pretty new when we started and proven <em>&lsquo;best practices&rsquo;</em> were yet to be seen. Yet it&rsquo;s still a nice experience to work with it.</p><p>Compared to other technologies we have used, React is really fast to start with and has very few concepts to grasp to be productive. It also works very well with immutable data and makes it easy to reuse components.</p><p>If you&rsquo;re still unsure if React is for you, I highly recommend you give it a try. It&rsquo;s really good and you can be pretty productive even after your project has grown big.</p><h1 id=project-structure>Project structure<a hidden class=anchor aria-hidden=true href=#project-structure>#</a></h1><p>From the beginning we started to organize our code after domain concepts and functionalities. This is simply the best way to keep stuff around. Forget all this nonsense about <code>actions</code>, <code>components</code>, <code>stores</code> folders. After your project grows it&rsquo;ll make you suffer. Keeping all business related stuff together makes moving things around really easy. You can easily find things you plan to change, remove functionalities and refactor.</p><p>So how does our directory structure looks like? Here&rsquo;s an example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ROOT
</span></span><span class=line><span class=cl><span class=p>|</span>- src
</span></span><span class=line><span class=cl><span class=p>|</span>-- core <span class=o>(</span>application core abstractions and main component<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>-- components <span class=o>(</span>basic reusable components that are not domain specific, ex: confirm popup, section, date selector, etc.
</span></span><span class=line><span class=cl><span class=p>|</span>-- modules <span class=o>(</span>here goes all the important stuff<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>--- advanced-search
</span></span><span class=line><span class=cl><span class=p>|</span>---- advanced-search-component.jsx
</span></span><span class=line><span class=cl><span class=p>|</span>---- advanced-search-component.test.jsx
</span></span><span class=line><span class=cl><span class=p>|</span>---- advanced-search-store.js
</span></span><span class=line><span class=cl><span class=p>|</span>---- advanced-search-store.test.js
</span></span><span class=line><span class=cl><span class=p>|</span>---- advanced-search-toolbar-component.jsx
</span></span><span class=line><span class=cl><span class=p>|</span>---- advanced-search-actions.js
</span></span><span class=line><span class=cl><span class=p>|</span>---- index.js <span class=o>(</span>what we <span class=nb>export</span> in this module<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>--- user-profile
</span></span><span class=line><span class=cl><span class=p>|</span>---- ...
</span></span><span class=line><span class=cl><span class=p>|</span>- <span class=nb>test</span>
</span></span><span class=line><span class=cl><span class=p>|</span>-- pages <span class=o>(</span>Page objects <span class=k>for</span> e2e tests<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>-- e2e <span class=o>(</span>Selenium end to end/UI tests<span class=o>)</span>
</span></span></code></pre></div><p>As you can see, we keep unit tests in same directories as production code. This way we can have relative import paths and we don&rsquo;t have to change anything when we move whole modules around. Want to move some components to another module? No problem, just move all files.</p><p>It&rsquo;s also not a problem when we release. Tests are filtered out from production bundle with simple regular expression.</p><p>It&rsquo;s also a good idea to keep index.js file inside each module and make sure external code use only module path to import stuff. It allows you to make import names shorter and more meaningful. It&rsquo;s also a form of <em>&lsquo;poor mans&rsquo;</em> encapsulation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>const</span> <span class=nx>AdvancedSearch</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;modules/advanced-search&#39;</span><span class=p>).</span><span class=nx>component</span>
</span></span></code></pre></div><h1 id=components-and-state>Components and state<a hidden class=anchor aria-hidden=true href=#components-and-state>#</a></h1><p>This is something that took us a while to figure out. I think that you should always keep display components stateless. You can usually use React <a href=https://facebook.github.io/react/docs/reusable-components.html#stateless-functions>stateless functional components</a> for this.</p><p>Of course you&rsquo;ll need also somehow to map store state to your UI. This should be done inside separate, stateful components. These should not mess with presentation. They should pass all their state to child components by props, eventually select which components to render based on state, nothing more. How things look is totally up to stateless components.</p><p>It&rsquo;ll make your components really easy to test and they&rsquo;ll be as reusable as possible. Without it you&rsquo;ll be constantly fighting with stores mocking, just to test if divs rendered properly and that data is displayed where it should. Managing state along with presentation also makes your components hard to reuse. Not to mention that components messing with state and presentation at once can get large.</p><p>Most of the time you should be able to generate these stateful wrappers or they will be very simple to write and test.</p><p>To be honest, we still have quite a few these stateful display components in our project waiting to be refactored, but it&rsquo;s not something I recommend to have. It&rsquo;s painful to make any changes in them.</p><h1 id=testing>Testing<a hidden class=anchor aria-hidden=true href=#testing>#</a></h1><p>We don&rsquo;t use <a href=https://facebook.github.io/jest/>Jest</a> for testing.
In my opinion mocking everything implicitly is not a very good idea. After a while you don&rsquo;t know what&rsquo;s mocked and what&rsquo;s not.</p><p><strong>Update:</strong> <em>As of version <a href=https://facebook.github.io/jest/blog/2016/09/01/jest-15.html>15.0</a> Jest <a href=https://facebook.github.io/jest/blog/2016/09/01/jest-15.html#disabled-automocking>no longer mocks things by default</a>. Haven&rsquo;t used it very much, but I think it might be worth to try it out now.</em></p><p>All our components receive dependencies via props, so standard Jasmine/Karma testing suite is totally enough. We mock things and create spies as needed using plain JS and Jasmine. Every time we needed something more meant it was rather a design issue than library limitation (components trying to do too much or too big/nested data structures).</p><p>Even stores are passed to stateful components using props. This way we can easily mock them or use real objects when needed and discard them afterwards. No ugly shared state that might not be cleaned up and break tests.</p><p>Also our stores and backend APIs use factories that get all outside dependencies from parameters:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>create</span><span class=o>:</span> <span class=nx>createSearchStore</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=k>default</span><span class=o>:</span> <span class=nx>createSearchStore</span><span class=p>(</span><span class=nx>defaultDispatcher</span><span class=p>,</span> <span class=nx>backendApi</span><span class=p>.</span><span class=k>default</span><span class=p>),</span>
</span></span><span class=line><span class=cl>  <span class=nx>events</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Again, mocking and cleaning up is very easy.</p><h1 id=immutability>Immutability<a hidden class=anchor aria-hidden=true href=#immutability>#</a></h1><p>You should keep all your data immutable. You can use things like <a href=https://facebook.github.io/immutable-js/>Immutable.js</a> and it will probably work pretty well (despite it&rsquo;s sometime awkward APIs), but just not modifying anything in place and using Object.assign or similar utils instead will make your life much easier. Especially when you need to implement <em><a href=https://facebook.github.io/react/docs/component-specs.html#updating-shouldcomponentupdate>shouldComponentUpdate</a></em> from time to time.</p><p>The lowest level you mutate anything should be store itself. Everything below should never be touched.</p><p>Don&rsquo;t be worried about performance. JS VMs are pretty damn fast when creating and destroying a lot of objects.</p><h1 id=state-changes-and-async-calls>State changes and async calls<a hidden class=anchor aria-hidden=true href=#state-changes-and-async-calls>#</a></h1><p>We keep all sate changing code inside stores. Stores mutate themselves in response to actions and action creators have no idea about internals of store. This also means that async calls are done inside store and do not call any actions. They just update internal state and fire regular store events.</p><p>It works pretty well for us despite being little controversial. Some guys recommend to do these things in actions and make your stores a dumb bag for data. This might also work well, especially when you need to intercept async calls globally and modify some other part of application state. But please decide which one you like more and stick to it. Having some of it in actions and some in stores will probably give you headache.</p><p>All business logic in stores makes our action creators dumb, so we usually generate them from simple object with events. If you go with second solution you can probably generate most of your stores.</p><p>Also it means we sometimes need to make stores listen to stores. We have few of these with no issues. It looks and works much better than <em>&lsquo;hacky&rsquo;</em> <em><a href=https://facebook.github.io/flux/docs/dispatcher.html#api>waitFor</a></em> in dispatcher API.</p><h1 id=redux>Redux?<a hidden class=anchor aria-hidden=true href=#redux>#</a></h1><p>After some time it appeared to me, that some of my conclusions are quite similar to what Dan Abramov is doing in <a href=http://redux.js.org>Redux</a>. It&rsquo;s little bit more extreme with its single store and pure functions, but after testing it for some time I think it&rsquo;s really good. So another good idea for your next app might be to simply use Redux. It&rsquo;s something I&rsquo;m probably going to do in mine.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://marekpiechut.github.io/tags/react/>React</a></li><li><a href=https://marekpiechut.github.io/tags/javascript/>Javascript</a></li></ul><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share One year with React on x" href="https://x.com/intent/tweet/?text=One%20year%20with%20React&amp;url=https%3a%2f%2fmarekpiechut.github.io%2fpost%2f2016-09-02-react-lessons-learned%2f&amp;hashtags=react%2cjavascript"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share One year with React on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmarekpiechut.github.io%2fpost%2f2016-09-02-react-lessons-learned%2f&amp;title=One%20year%20with%20React&amp;summary=One%20year%20with%20React&amp;source=https%3a%2f%2fmarekpiechut.github.io%2fpost%2f2016-09-02-react-lessons-learned%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share One year with React on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmarekpiechut.github.io%2fpost%2f2016-09-02-react-lessons-learned%2f&title=One%20year%20with%20React"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share One year with React on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmarekpiechut.github.io%2fpost%2f2016-09-02-react-lessons-learned%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share One year with React on whatsapp" href="https://api.whatsapp.com/send?text=One%20year%20with%20React%20-%20https%3a%2f%2fmarekpiechut.github.io%2fpost%2f2016-09-02-react-lessons-learned%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share One year with React on telegram" href="https://telegram.me/share/url?text=One%20year%20with%20React&amp;url=https%3a%2f%2fmarekpiechut.github.io%2fpost%2f2016-09-02-react-lessons-learned%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share One year with React on ycombinator" href="https://news.ycombinator.com/submitlink?t=One%20year%20with%20React&u=https%3a%2f%2fmarekpiechut.github.io%2fpost%2f2016-09-02-react-lessons-learned%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>© 2024 - Marek Piechut</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>